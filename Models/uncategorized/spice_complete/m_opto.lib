*Model 4n33
*FORMAT:  PSPICE
.subckt 4n33_MC 4 5 3 1 2
* 4 -> LED ANODE   5 -> LED CATHODE
* 3 -> EMITTER     1 -> COLLECTOR   2 -> BASE

DIO  4  10  4n33_dio
VD  10  5  0V
RD  4  5  6e7
FDD  0  2  VD  0.15
RF  2  0  1e9
CF  1  4  1e-12
XDAR  1 2 3  4n33_dar_MC
RDAR  1  3  4e9
* MODEL FORMAT: PSpice
.MODEL 4n33_dio d
+IS=2.90836e-12 RS=1.81548 N=2 EG=0.644108
+XTI=3.99996 BV=1000 IBV=0.0001 CJO=2.02387e-11
+VJ=0.4 M=0.271299 FC=0.5 TT=1e-09
+KF=0 AF=1
.ends 4n33_MC

.SUBCKT 4n33_dar_MC 1 2 3
* MODEL FORMAT: PSpice
* Darlington macro model
* External node designations
* Node 1 -> Collect
* Node 2 -> Base
* Node 3 -> Emitter
Q1 1 2 4 qmodel
Q2 1 4 3 q1model 8.93463
D1 3 1 dmodel
R1 2 4 10000
R2 4 3 1000
* Default values used in dmodel
*   EG=1.11 TT=0 BV=infinite
.MODEL dmodel d
+IS=1e-12 RS=10.5392 N=1.00539 XTI=3.00539
+CJO=0 VJ=0.75 M=0.33 FC=0.5
.MODEL qmodel npn
+IS=2.40152e-12 BF=46.1011 NF=1.2 VAF=30
+IKF=0.00662634 ISE=9.73117e-14 NE=1.23006 BR=4.14416
+NR=1.5 VAR=146.759 IKR=0.0662634 ISC=9.73117e-14
+NC=2.0474 RB=10.7666 IRB=0.205422 RBM=10.5475
+RE=0.100058 RC=0.99859 XTB=0.457057 XTI=2.9909 EG=1.05
+CJE=1e-11 VJE=0.75 MJE=0.33 TF=1e-09
+XTF=1 VTF=10 ITF=0.01 CJC=1e-11
+VJC=0.75 MJC=0.33 XCJC=0.9 FC=0.5
+TR=1e-07 PTF=0 KF=0 AF=1
.MODEL q1model npn
+IS=2.40152e-12 BF=46.1011 NF=1.2 VAF=30
+IKF=0.00662634 ISE=9.73117e-14 NE=1.23006 BR=4.14416
+NR=1.5 VAR=146.759 IKR=0.0662634 ISC=9.73117e-14
+NC=2.0474 RB=10.7666 IRB=0.205422 RBM=10.5475
+RE=0.100058 RC=0.99859 XTB=0.457057 XTI=2.9909 EG=1.05
+CJE=1e-11 VJE=0.75 MJE=0.33 TF=1e-09
+XTF=1 VTF=10 ITF=0.01 CJC=0
+VJC=0.75 MJC=0.33 XCJC=0.9 FC=0.5
+TR=1e-07 PTF=0 KF=0 AF=1
.ENDS 4n33_dar_MC
* model moc223
* FORMAT:  PSPICE
.subckt moc223_MC 4 5 3 1 2
* 4 -> LED ANODE   5 -> LED CATHODE
* 3 -> EMITTER     1 -> COLLECTOR   2 -> BASE

DIO  4  10  moc223_dio
VD  10  5  0V
RD  4  5  6e7
FI  0  11  VD  1
RFI  11  0  1000
XDL  11  0  12  delay_MC
VDD  12  13  0
RXDL  13  0  1000
FDD  0  2  VDD  0.1
RF  2  0  1e9
CF  1  4  1e-12
XDAR  1 2 3  moc223_dar_MC
RDAR  1  3  4e9

.MODEL moc223_dio d
+IS=2.12534e-12 RS=1.37765 N=2 EG=0.6
+XTI=2.96819 BV=1000 IBV=0.0001 CJO=1.84171e-11
+VJ=1.203 M=0.356504 FC=0.5 TT=1e-09
+KF=0 AF=1

.ends moc223_MC

.SUBCKT  delay_MC  1  2  3
* Nodes: <Vin> <GGND> <Vout>
* Vin  -->  Input Voltage
* GGND -->  Global Ground
* Vout -->  Output Voltage
RIN	1	2	1.0E9
E1	10	0	1	2	1
TD	10	0	11	0	Z0=50 TD=3e-06
RD	11	0	50
EO	30	2	11	0	1
RO1	30	3	1
RO2	3	2	1.0E9
.ENDS  delay_MC

.SUBCKT moc223_dar_MC 1 2 3
* MODEL FORMAT: PSpice
* Darlington macro model
* External node designations
* Node 1 -> Collect
* Node 2 -> Base
* Node 3 -> Emitter
Q1 1 2 4 qmodel
Q2 1 4 3 q1model 8.88022
D1 3 1 dmodel
R1 2 4 10000
R2 4 3 1000
* Default values used in dmodel
*   EG=1.11 TT=0 BV=infinite
.MODEL dmodel d
+IS=1e-12 RS=9.52529 N=0.995253 XTI=2.99525
+CJO=0 VJ=0.75 M=0.33 FC=0.5
.MODEL qmodel npn
+IS=2.99506e-12 BF=19.5647 NF=1.11791 VAF=56.0325
+IKF=0.088067 ISE=1.43852e-13 NE=2.13329 BR=1.01562
+NR=1.45409 VAR=98.9714 IKR=0.0952542 ISC=9.99997e-14
+NC=1.99519 RB=9.57894 IRB=0.195253 RBM=9.52549
+RE=0.0977153 RC=0.999915 XTB=0.503191 XTI=2.99553 EG=1.11591
+CJE=2.15822e-11 VJE=0.95 MJE=0.23 TF=9.99885e-10
+XTF=1 VTF=10 ITF=0.01 CJC=1.56635e-11
+VJC=0.432344 MJC=0.345351 XCJC=0.9 FC=0.5
+TR=1e-07 PTF=0 KF=0 AF=1
.MODEL q1model npn
+IS=2.99506e-12 BF=19.5647 NF=1.11791 VAF=56.0325
+IKF=0.088067 ISE=1.43852e-13 NE=2.13329 BR=1.01562
+NR=1.45409 VAR=98.9714 IKR=0.0952542 ISC=9.99997e-14
+NC=1.99519 RB=9.57894 IRB=0.195253 RBM=9.52549
+RE=0.0977153 RC=0.999915 XTB=0.503191 XTI=2.99553 EG=1.11591
+CJE=2.15822e-11 VJE=0.95 MJE=0.23 TF=9.99885e-10
+XTF=1 VTF=10 ITF=0.01 CJC=0
+VJC=0.432344 MJC=0.345351 XCJC=0.9 FC=0.5
+TR=1e-07 PTF=0 KF=0 AF=1
.ENDS moc223_dar_MC
