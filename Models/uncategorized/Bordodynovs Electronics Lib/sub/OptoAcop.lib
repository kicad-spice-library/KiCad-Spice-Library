* OPTO TRIAC
* Helmut Sennewald  8/10/2004
* MOC3020  I_trig=8mA
*  D+  D-  MT2  MT1
.SUBCKT MOC3020 1 2 3 4
.PARAM Itrig=15m
.PARAM RH1=20k
.PARAM RH2=20k
.PARAM RH3=16.7k
Q2 vb1 vb1p vd1 0 PNP1
Q1 vb1p vb1 4 0 NPN1
R3 vb1 4 {RH2}
D1 1 2 DL
R1 ctrl1 4 1
C1 ctrl1 4 10
R2 ctrl1 vb1 {RH1}
R4 vd1 vb1p {RH3}
B1 ctrl1 4 I=-500*I(D1)*3m/Itrig 
R6 vd2 vb2 {RH2}
D3 vd2 3 D1
Q3 vb2 vb2p 4 0 PNP1
Q4 vb2p vb2 vd2 0 NPN1
E1 vd2 N001 ctrl1 4 -1
R5 N001 vb2 {RH1}
R7 vb2p 4 {RH3}
D2 3 vd1 D1
R34 3 4 100MEG
.MODEL PNP1 PNP(Is=1e-15 BF=10 Cjc=10p Cje=20p Tf=0.1u Ise=1e-12)
.MODEL NPN1 NPN(Is=1e-15 BF=10 Cjc=10p Cje=20p Tf=0.1u Ise=1e-12)
.MODEL D1 D(Is=0.1u Rs=2 Cj0=50p)
.MODEL DL D(Is=1e-20 Rs=5)
.ENDS
* OPTO TRIAC
* Helmut Sennewald  8/10/2004
* MOC3021  I_trig=8mA
*  D+  D-  MT2  MT1
.SUBCKT MOC3021 1 2 3 4
.PARAM Itrig=8m
.PARAM RH1=20k
.PARAM RH2=20k
.PARAM RH3=16.7k
Q2 vb1 vb1p vd1 0 PNP1
Q1 vb1p vb1 4 0 NPN1
R3 vb1 4 {RH2}
D1 1 2 DL
R1 ctrl1 4 1
C1 ctrl1 4 10
R2 ctrl1 vb1 {RH1}
R4 vd1 vb1p {RH3}
B1 ctrl1 4 I=-500*I(D1)*3m/Itrig 
R6 vd2 vb2 {RH2}
D3 vd2 3 D1
Q3 vb2 vb2p 4 0 PNP1
Q4 vb2p vb2 vd2 0 NPN1
E1 vd2 N001 ctrl1 4 -1
R5 N001 vb2 {RH1}
R7 vb2p 4 {RH3}
D2 3 vd1 D1
R34 3 4 100MEG
.MODEL PNP1 PNP(Is=1e-15 BF=10 Cjc=10p Cje=20p Tf=0.1u Ise=1e-12)
.MODEL NPN1 NPN(Is=1e-15 BF=10 Cjc=10p Cje=20p Tf=0.1u Ise=1e-12)
.MODEL D1 D(Is=0.1u Rs=2 Cj0=50p)
.MODEL DL D(Is=1e-20 Rs=5)
.ENDS

* OPTO TRIAC
* Helmut Sennewald  8/10/2004
* MOC3022   I_trig=5mA
*  D+  D-  MT2  MT1
.SUBCKT MOC3022 1 2 3 4
.PARAM Itrig=5m
.PARAM RH1=20k
.PARAM RH2=20k
.PARAM RH3=16.7k
Q2 vb1 vb1p vd1 0 PNP1
Q1 vb1p vb1 4 0 NPN1
R3 vb1 4 {RH2}
D1 1 2 DL
R1 ctrl1 4 1
C1 ctrl1 4 10
R2 ctrl1 vb1 {RH1}
R4 vd1 vb1p {RH3}
B1 ctrl1 4 I=-500*I(D1)*3m/Itrig 
R6 vd2 vb2 {RH2}
D3 vd2 3 D1
Q3 vb2 vb2p 4 0 PNP1
Q4 vb2p vb2 vd2 0 NPN1
E1 vd2 N001 ctrl1 4 -1
R5 N001 vb2 {RH1}
R7 vb2p 4 {RH3}
D2 3 vd1 D1
R34 3 4 100MEG
.MODEL PNP1 PNP(Is=1e-15 BF=10 Cjc=10p Cje=20p Tf=0.1u Ise=1e-12)
.MODEL NPN1 NPN(Is=1e-15 BF=10 Cjc=10p Cje=20p Tf=0.1u Ise=1e-12)
.MODEL D1 D(Is=0.1u Rs=2 Cj0=50p)
.MODEL DL D(Is=1e-20 Rs=5)
.ENDS

* OPTO TRIAC
* Helmut Sennewald  8/10/2004
* MOC3023   I_trig=3mA
*  D+  D-  MT2  MT1
.SUBCKT MOC3023 1 2 3 4
.PARAM Itrig=3m
.PARAM RH1=20k
.PARAM RH2=20k
.PARAM RH3=16.7k
Q2 vb1 vb1p vd1 0 PNP1
Q1 vb1p vb1 4 0 NPN1
R3 vb1 4 {RH2}
D1 1 2 DL
R1 ctrl1 4 1
C1 ctrl1 4 10
R2 ctrl1 vb1 {RH1}
R4 vd1 vb1p {RH3}
B1 ctrl1 4 I=-500*I(D1)*3m/Itrig 
R6 vd2 vb2 {RH2}
D3 vd2 3 D1
Q3 vb2 vb2p 4 0 PNP1
Q4 vb2p vb2 vd2 0 NPN1
E1 vd2 N001 ctrl1 4 -1
R5 N001 vb2 {RH1}
R7 vb2p 4 {RH3}
D2 3 vd1 D1
R34 3 4 100MEG
C34 3 4 30p
.MODEL PNP1 PNP(Is=1e-15 BF=10 Cjc=5p Cje=20p Tf=0.1u Ise=1e-12)
.MODEL NPN1 NPN(Is=1e-15 BF=10 Cjc=5p Cje=20p Tf=0.1u Ise=1e-12)
.MODEL D1 D(Is=0.1u Rs=2 Cj0=50p)
.MODEL DL D(Is=1e-20 Rs=5)
.ENDS
*
* Sharp Optocoupler PC357NT 
.Subckt Pc357nt A K E C
D1 A N001 LED
Q1 C 5 E 0 NPN1 1
R1 5 E 10G
C1 A K 20p
V1 N001 K 0
R2 N002 0 1
C2 N002 0 200n
B1 0 N002 I=TABLE(I(V1), 0,0,10m,10m,15m, 14m, 20m,17m,40m,25m,80m,35m,160m,50m)
G1 E 5 N002 0 0.035
C3 C 5 10p
C4 A C 0.3p
C5 K E 0.3p
C6 5 E 10p
.model LED D(Is=1e-15 Rs=4 N=1.5 Eg=1.7 CJO=30p TT=100n)
.model NPN1 NPN(Is=1e-12 BF=200 VAF=80 IKF=0.025 ISE=1e-9 NE=2 CJC=20p CJE=50p TF=5e-8 Rb=100 Rc=20 Re=5)
.Ends
*
.subckt 4N25 1 2 3 4 5
R1 N003 2 2
D1 1 N003 LD
G1 3 5 N003 2 .876m
C1 1 2 18p
Q1 3 5 4 [4] NP
.model LD D(Is=1e-20 Cjo=18p)
.model NP NPN(Bf=610 Vaf=140 Ikf=15m Rc=1 Cjc=19p Cje=7p Cjs=7p C2=1e-15)
.ends
*
.subckt 4N27 1 2 3 4 5
R1 N003 2 2
D1 1 N003 LD
G1 3 5 N003 2 .582m
C1 1 2 18p
Q1 3 5 4 [4] NP
.model LD D(Is=1e-20 Cjo=18p)
.model NP NPN(Bf=610 Vaf=140 Ikf=15m Rc=1 Cjc=19p Cje=7p Cjs=7p C2=1e-15)
.ends
* opto coupler  4N35
.subckt 4N35 A K E C B
D1 A N002 LED
Q1 C B E 0 NPN1 1
R1 B E 10G
C1 A K 20p
V1 N002 K 0
R2 N001 0 1
C2 N001 0 1
B1 0 N001 I=TABLE(I(V1), 0,0, 0.3m,0, 0.4m,0.002m, 0.5m,0.01m, 1m,0.08m, 1.5m,0.25m, 2m,0.6m, 2.5m,1.25m, 3m,1.9m, 4m,3.6m, 5m,6m, 7m,11m, 9m,16m, 10m,18.5m, 15m,30m, 20m,41m, 25m,49m, 30m,55m, 40m,60m, 50m,61m)
G1 E B N001 0 3.2m
C3 C B 2p
C4 A C 0.3p
C5 K E 0.3p
C6 B E 10p
C7 C E 10p
.model LED D(Is=1e-15 Rs=2 N=1.5 Eg=1.7 CJO=18p TT=100n)
.model NPN1 NPN(Is=1e-12 BF=400 VAF=100 IKF=.1 ISE=1e-11 NE=2 CJC=19p CJE=9p TF=.5e-8 Rb=100 Rc=5 Re=1)
.ends
*
* opto coupler  4N38
.subckt 4N38 A K E C B
D1 A N002 LED
Q1 C B E 0 NPN1 1
R1 B E 10G
C1 A K 20p
V1 N002 K 0
R2 N001 0 1
C2 N001 0 1
B1 0 N001 I=TABLE(I(V1), 0,0, 0.3m,0, 0.4m,0.002m, 0.5m,0.01m, 1m,0.08m, 1.5m,0.25m, 2m,0.6m, 2.5m,1.25m, 3m,1.9m, 4m,3.6m, 5m,6m, 7m,11m, 9m,16m, 10m,18.5m, 15m,30m, 20m,41m, 25m,49m, 30m,55m, 40m,60m, 50m,61m)
G1 E B N001 0 3.2m
C3 C B 2p
C4 A C 0.3p
C5 K E 0.3p
C6 B E 10p
C7 C E 10p
.model LED D(Is=1e-15 Rs=2 N=1.5 Eg=1.7 CJO=18p TT=100n)
.model NPN1 NPN(Is=1e-12 BF=400 VAF=100 IKF=.1 ISE=1e-11 NE=2 CJC=19p CJE=9p TF=.5e-8 Rb=100 Rc=5 Re=1)
.ends
*
.subckt CNY17 1 2 3 4 5
R1 N003 2 2
D1 1 N003 LD
G1 3 5 N003 2 {Igain}
C1 1 2 18p
Q1 3 5 4 [4] NP
.model LD D(Is=1e-20 Cjo=18p)
.model NP NPN(Bf=610 Vaf=140 Ikf=15m Rc=1 Cjc=19p Cje=7p Cjs=7p C2=1e-15)
.ends
*
.subckt MOC205 1 2 3 4 5
R1 N003 2 2
D1 1 N003 LD
G1 3 5 N003 2 {Igain}
C1 1 2 18p
Q1 3 5 4 [4] NP
.model LD D(Is=1e-20 Cjo=18p)
.model NP NPN(Bf=610 Vaf=140 Ikf=15m Rc=1 Cjc=19p Cje=7p Cjs=7p C2=1e-15)
.ends
* Helmut Sennewald, 08/18/2006, V1.1
.subckt Hcpl-3140 A C VEE VO VCC
D1 A N008 LED
C1 A C 1p
V1 N008 C 0
R2 TRIMP 0 250
C2 TRIMP 0 200p
B2 0 TRIMP I=TABLE(I(V1), 0,0,6m,8m)
C11 A N001 0.3p
C12 C N001 0.3p
Rpwr VCC VEE 15k
Cpwr VCC VEE 20p
Q1 VCC N006 N007 0 NPN2
Q2 N009 N010 VEE 0 NPN2
A1 0 ENA 0 N003 0 0 H_EN 0 AND tripdt=5n trise=5n
R5 VCC N002 R=10+5*abs(V(VCC)-V(VO))
S1 N005 N002 H_EN 0 SW1
R3 VEE N010 35
R6 N005 N007 10
R11 A N001 4G
R12 C N001 4G
D2 VO VCC Dd1
A3 LIM1 0 0 0 0 0 ENA 0 AND Ref=1 td=170n
A4 0 0 ENA 0 0 0 N003 0 AND td=10n
A2 0 N003 0 ENA 0 L_EN 0 0 OR trise=5n
R1 TRIMP LIM1 8k
C5 LIM1 0 20p
D3 TRIMP N004 DI
R9 N004 LIM1 8k
R10 N005 N006 20
C6 VCC N005 20p
R4 N009 VO 1.8
R7 N007 VO 1
D4 VEE VO Dd1
G2 VEE N010 L_EN 0 {2/35}
.model LED D(Is=1e-18 Rs=4 N=1.6 Eg=1.7 CJO=60p Tt=10n)
.model Dd1 D(Is=1e-7 Rs=10 Cjo=5p Tt=5n)
.model DI D(Is=1e-6 N=0.01)
.model SW1 SW(Ron=100m Roff=1e7 Vt=0.5 VH=-0.4)
.model NPN2 NPN(Is=1e-14 BF=15 VAF=40 Cjc=10p TF=5e-10)
.Ends
*
* 6N137.sub_Helmut Sennewald
.subckt 6N137 A K S C V E
D1 A N001 LED
C1 A K 1p
V1 N001 K 0
R2 ta S 100
C2 ta S 200p
B2 S ta I=TABLE(I(V1), 0,0,2.5m,50m,15m, 55m)
C10 A C 0.1p
C11 K S 0.1p
M1 C ga S S NMOS1
C5 C ga 10p
De1 E V Dd1
R6 V E 6k
R7 E S 100k
B4 0 en I=TABLE(V(E,S), 0,0,1.4,0,1.5, 1m)
R4 en 0 1k
R5 V S 1.5k
C6 C S 10p
C4 en 0 10p
B3 S ga I=V(ta,s)*V(en)*10m
R3 ga S 100
C3 ga S 20p
.model LED D(Is=1e-17 Rs=4 N=1.5 Eg=1.7 CJO=5p Tt=5n)
.model NMOS1 NMOS(Vt0=2 Kp=0.03 Rs=5 Rd=5 lambda=0.02)
.model Dd1 D(Is=1e-7 Rs=10 Cjo=5p Tt=5n)
.Ends
*
* HCNR200 Linear Optocoupler SPICE Model
*                LED Cathode
*                | LED Anode
*                | | PD1 Cathode
*                | | | PD1 Anode
*                | | | | PD2 Anode
*                | | | | | PD2 Cathode
*                | | | | | |
.SUBCKT HCNR200  1 2 3 4 5 6

* LED circuit
QLED1 8 2 7 QCPL .5
QLED2 9 2 7 QCPL .5
VLED 7 1 DC .685
VPD1 8 1 DC 2
VPD2 9 1 DC 2

* Input photodiode circuit
DPD1 4 3 DPHOTO
FPD1 3 4 VPD1 -1
CPD1 4 3 8P

* Output photodiode circuit
DPD2 5 6 DPHOTO
FPD2 6 5 VPD2 -1
CPD2 5 6 8P

* Photodiode model
.MODEL DPHOTO D(IS=4.5E-12 RS=150 N=1.3 XTI=4 EG=1.11
+  CJO=14P M=1.96 VJ=1.9)

* LED/Optical-coupling transistor model
.model QCPL NPN(IS=2.214E-19 BF=10m NF=1.010 IKF=11.00m ISE=1.167P
+  NE=1.737 RB=3.469 VAF=100 TF=1.77U CJE=80P)

.ENDS HCNR200
*IL300 from Siemens * RAP 5/97:
* A - Anode of LED
* C - Cathode of LED
* A1 - Anode of photodetector 1
* C1 - Cathode of photodetector 1
* A2 - Anode of photodetector 2
* C2 - Cathode of photodetector 2
* K1 - Servo gain
* K2 - Forward gain
* K3 - Transfer gain
*
.Subckt IL300 A C A1 C1 A2 C2 PARAMS: K1=0.007 K2=0.007 K3=1
DLED A E Demit
VE E C 0
E2 D1 0 TABLE ; {Ip2 vs IF}
+ {(0.955414823*0.999409809**(1/(abs(I(VE))+0.1p))*I(VE)**0.963133681)}
+ (0,0) (1,1)
Rdly1 D1 D2 1K
Cdly1 D2 0 0.17N
Rdly2 D2 D3 1K
Cdly2 D3 0 0.17N
Gdly1 C1 A1 VALUE {K1*V(D3)}
D1 A1 C1 Dtect
RD1 A1 C1 15G
Gdly2 C2 A2 VALUE {K3*K2*V(D3)}
D2 A2 C2 Dtect
RD2 A2 C2 15G
..model Demit D IS=1.51E-16 N=1.495822 RS=2.624361 BV=5 IBV=1U
+ CJO=15P VJ=1 M=0.5 EG=1.424 TT=500N
..model Dtect D IS=0.5p N=1 RS=0.001 BV=50 IBV=1U
+ CJO=14P VJ=0.159621 M=0.344264 EG=1.11 TT=10N
.ends


*NPN Optoisolator pkg:DIP6 1,2,5,4
*Connections
*               LED Anode
*               | LED Cathode
*               | | Emitter
*               | | | Collector
*               | | | | Base
*               | | | | |
.SUBCKT OPTOISO 1 2 4 5 6
VM    1 12 DC 0
D1   12  2 LED
R1   10 11 450
C1   11  0 1000PF
H1   10  0 VM 3.33E-2
G1    5  6 11 0 1
Q1    5  6  4 QNPN
.MODEL LED D(IS=2.5E-12 RS=.75 CJO=3.5E-11 N=2)
.MODEL QNPN NPN(IS=3.33E-11 NF=1.35 CJC=4.74E-11 CJE=167E-12 TF=9.23E-10
+ TR=1.48E-7 BF=150 BR=10 IKF=.1 VAF=100
.ENDS OPTOISO